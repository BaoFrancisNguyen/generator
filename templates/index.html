<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur de Donn√©es √ânerg√©tiques - Malaisie</title>
    
    <!-- Styles CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <!-- Meta tags pour SEO et partage -->
    <meta name="description" content="G√©n√©rateur de donn√©es de consommation √©nerg√©tique pour la Malaisie bas√© sur OpenStreetMap">
    <meta name="keywords" content="√©nergie, malaisie, openstreetmap, donn√©es, consommation">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üá≤üáæ</text></svg>">
</head>
<body>
    <!-- CONTENEUR PRINCIPAL -->
    <div class="container">
        <!-- EN-T√äTE PRINCIPAL -->
        <header class="main-header">
            <h1>üá≤üáæ G√©n√©rateur de Donn√©es √ânerg√©tiques</h1>
            <p class="subtitle">
                Simulation de consommation √©lectrique pour la Malaisie bas√©e sur OpenStreetMap
            </p>
        </header>

        <!-- ZONE D'ALERTES -->
        <div id="alerts" class="alerts-container" aria-live="polite"></div>

        <!-- CONFIGURATION DE ZONE -->
        <div class="professional-card">
            <div class="card-header">
                <h3 class="card-title">üåè Configuration de la zone d'√©tude</h3>
                <div class="card-badge">Malaisie</div>
            </div>
            <div class="card-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="zoneSelect">S√©lection de ville :</label>
                        <select id="zoneSelect" class="form-control" aria-describedby="zoneHelp">
                            <option value="">-- Choisir une ville --</option>
                            <option value="Kuala Lumpur">Kuala Lumpur (Territoire F√©d√©ral)</option>
                            <option value="George Town">George Town (Penang)</option>
                            <option value="Ipoh">Ipoh (Perak)</option>
                            <option value="Shah Alam">Shah Alam (Selangor)</option>
                            <option value="Petaling Jaya">Petaling Jaya (Selangor)</option>
                            <option value="Johor Bahru">Johor Bahru (Johor)</option>
                            <option value="Kota Kinabalu">Kota Kinabalu (Sabah)</option>
                            <option value="Kuching">Kuching (Sarawak)</option>
                        </select>
                        <small id="zoneHelp" class="form-text">S√©lectionnez une ville pour commencer l'analyse</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="customLocation">Ou coordonn√©es personnalis√©es :</label>
                        <input type="text" id="customLocation" class="form-control" 
                               placeholder="Lat, Lon (ex: 3.1390, 101.6869)"
                               aria-describedby="coordHelp">
                        <small id="coordHelp" class="form-text">Format: latitude, longitude</small>
                    </div>
                </div>

                <!-- INFORMATIONS DE ZONE S√âLECTIONN√âE -->
                <div class="zone-info-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 20px;">
                    <div class="data-card">
                        <div class="data-card-header">
                            <div class="data-card-title">üìç Zone s√©lectionn√©e</div>
                        </div>
                        <div class="data-card-body">
                            <div class="data-item">
                                <span class="data-label">Nom :</span>
                                <span class="data-value" id="zoneNameDisplay">-</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Type :</span>
                                <span class="data-value" id="zoneTypeDisplay">-</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Population :</span>
                                <span class="data-value" id="zonePopulationDisplay">-</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">√âtat :</span>
                                <span class="data-value" id="zoneStateDisplay">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="data-card">
                        <div class="data-card-header">
                            <div class="data-card-title">üèóÔ∏è Estimation OSM</div>
                        </div>
                        <div class="data-card-body">
                            <div class="data-item">
                                <span class="data-label">B√¢timents estim√©s :</span>
                                <span class="data-value" id="estimatedBuildings">-</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Temps de requ√™te :</span>
                                <span class="data-value" id="queryTimeEstimate">-</span>
                            </div>
                            <div class="data-item">
                                <span class="data-label">Statut API :</span>
                                <span class="data-value" id="apiStatus">üîÑ En attente</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- CARTE DE PR√âVISUALISATION -->
        <div class="professional-card">
            <div class="card-header">
                <h3 class="card-title">üó∫Ô∏è Pr√©visualisation interactive</h3>
                <div class="button-group">
                    <button id="loadRealBuildings" class="btn btn-success btn-sm" 
                            data-tooltip="Charge les vrais b√¢timents depuis OpenStreetMap">
                        üèóÔ∏è Charger b√¢timents r√©els
                    </button>
                    <button id="centerOnZone" class="btn btn-info btn-sm"
                            data-tooltip="Centre la carte sur la zone s√©lectionn√©e">
                        üìç Centrer sur zone
                    </button>
                    <button id="clearPreview" class="btn btn-outline btn-sm"
                            data-tooltip="Efface tous les b√¢timents de la carte">
                        üßπ Effacer
                    </button>
                </div>
            </div>
            
            <div class="map-wrapper" id="mapWrapper">
                <div id="previewMap" class="leaflet-map" role="application" aria-label="Carte interactive de pr√©visualisation"></div>
                
                <!-- L√âGENDE DE LA CARTE -->
                <div id="mapLegend" class="map-legend">
                    <div class="legend-title">üèóÔ∏è Types de b√¢timents</div>
                    <div id="buildingTypesStats">
                        <p class="text-center text-light">Chargez les b√¢timents pour voir les statistiques</p>
                    </div>
                    
                    <div class="legend-title" style="margin-top: 15px;">üìä L√©gende des couleurs</div>
                    <div class="legend-items">
                        <div class="legend-item">
                            <span class="legend-color" style="background: #4CAF50; width: 15px; height: 15px; display: inline-block; margin-right: 8px; border-radius: 3px;"></span>
                            R√©sidentiel
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #2196F3; width: 15px; height: 15px; display: inline-block; margin-right: 8px; border-radius: 3px;"></span>
                            Commercial
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #FF9800; width: 15px; height: 15px; display: inline-block; margin-right: 8px; border-radius: 3px;"></span>
                            Industriel
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #9C27B0; width: 15px; height: 15px; display: inline-block; margin-right: 8px; border-radius: 3px;"></span>
                            Public
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card-footer">
                <div class="flex flex-between">
                    <div id="mapStatus" class="text-secondary">
                        S√©lectionnez une zone et cliquez sur "Charger b√¢timents r√©els"
                    </div>
                    <div class="badge badge-info">
                        <span id="loadedBuildingsCount">0</span> b√¢timents charg√©s
                    </div>
                </div>
            </div>
        </div>

        <!-- CONFIGURATION TEMPORELLE -->
        <div class="professional-card">
            <div class="card-header">
                <h3 class="card-title">‚è∞ Configuration temporelle</h3>
                <div class="card-badge">P√©riode de simulation</div>
            </div>
            <div class="card-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="numBuildings">Nombre de b√¢timents :</label>
                        <input type="number" id="numBuildings" class="form-control" 
                               min="1" max="10000" value="100" 
                               aria-describedby="buildingsHelp">
                        <small id="buildingsHelp" class="form-text">Entre 1 et 10000 b√¢timents</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="startDate">Date de d√©but :</label>
                        <input type="date" id="startDate" class="form-control" 
                               value="2024-01-01" aria-describedby="startHelp">
                        <small id="startHelp" class="form-text">Date de d√©but de la simulation</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="endDate">Date de fin :</label>
                        <input type="date" id="endDate" class="form-control" 
                               value="2024-01-31" aria-describedby="endHelp">
                        <small id="endHelp" class="form-text">Date de fin de la simulation</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="freq">Fr√©quence des donn√©es :</label>
                        <select id="freq" class="form-control" aria-describedby="freqHelp">
                            <option value="H">Horaire</option>
                            <option value="D" selected>Quotidienne</option>
                            <option value="W">Hebdomadaire</option>
                            <option value="M">Mensuelle</option>
                        </select>
                        <small id="freqHelp" class="form-text">Intervalle entre chaque mesure</small>
                    </div>
                </div>

                <!-- OPTIONS AVANC√âES -->
                <details class="mt-3">
                    <summary style="cursor: pointer; font-weight: 600; color: #2c5aa0; margin-bottom: 15px;">‚öôÔ∏è Options avanc√©es</summary>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="noiseLevel">Niveau de bruit :</label>
                            <select id="noiseLevel" class="form-control">
                                <option value="low">Faible (¬±5%)</option>
                                <option value="medium" selected>Moyen (¬±15%)</option>
                                <option value="high">√âlev√© (¬±25%)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="seasonality">Saisonnalit√© :</label>
                            <select id="seasonality" class="form-control">
                                <option value="true" selected>Activ√©e</option>
                                <option value="false">D√©sactiv√©e</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="dataQuality">Qualit√© des donn√©es :</label>
                            <select id="dataQuality" class="form-control">
                                <option value="high" selected>Haute qualit√©</option>
                                <option value="medium">Qualit√© moyenne</option>
                                <option value="low">Qualit√© basique</option>
                            </select>
                        </div>
                    </div>
                </details>
            </div>
        </div>

        <!-- ACTIONS PRINCIPALES -->
        <div class="professional-card">
            <div class="card-header">
                <h3 class="card-title">üöÄ G√©n√©ration des donn√©es</h3>
                <div class="card-badge">Actions</div>
            </div>
            <div class="card-body">
                <div class="button-group" style="justify-content: center;">
                    <button id="generateBtn" class="btn btn-primary" style="font-size: 1.1em; padding: 15px 30px;">
                        üèóÔ∏è G√©n√©rer les donn√©es √©nerg√©tiques
                    </button>
                    <button id="previewBtn" class="btn btn-info">
                        üëÅÔ∏è Aper√ßu des param√®tres
                    </button>
                    <button id="resetBtn" class="btn btn-outline">
                        üîÑ R√©initialiser
                    </button>
                </div>
                
                <!-- BARRE DE PROGRESSION -->
                <div id="progressContainer" class="progress-container" style="display: none;">
                    <div id="progressBar" class="progress-bar" style="width: 0%;"></div>
                </div>
                <div id="progressText" class="text-center" style="display: none; margin-top: 10px;"></div>
            </div>
        </div>

        <!-- R√âSULTATS - CORRIG√â POUR L'AFFICHAGE -->
        <div id="results" class="results-section">
            <!-- STATISTIQUES G√âN√âRALES -->
            <div class="professional-card">
                <div class="card-header">
                    <h3 class="card-title">üìä Statistiques de g√©n√©ration</h3>
                    <div class="card-badge">R√©sultats</div>
                </div>
                <div class="card-body">
                    <div id="statsGrid" class="stats-grid">
                        <!-- Les statistiques seront inject√©es ici par JavaScript -->
                    </div>
                </div>
            </div>

            <!-- APER√áU DES DONN√âES G√âN√âR√âES - CORRIG√â -->
            <div class="professional-card">
                <div class="card-header">
                    <h3 class="card-title">üìã Aper√ßu des donn√©es g√©n√©r√©es</h3>
                    <div class="card-badge">√âchantillon</div>
                </div>
                <div class="card-body">
                    <div id="dataPreview" class="data-preview">
                        <!-- L'aper√ßu des donn√©es sera inject√© ici par JavaScript -->
                    </div>
                </div>
            </div>

            <!-- GRAPHIQUES ET VISUALISATIONS -->
            <div class="professional-card" id="chartsSection" style="display: none;">
                <div class="card-header">
                    <h3 class="card-title">üìà Visualisations</h3>
                    <div class="card-badge">Graphiques</div>
                </div>
                <div class="card-body">
                    <div id="chartsContainer">
                        <!-- Les graphiques seront inject√©s ici -->
                    </div>
                </div>
            </div>

            <!-- T√âL√âCHARGEMENTS -->
            <div class="professional-card" id="downloadSection" style="display: none;">
                <div class="card-header">
                    <h3 class="card-title">üì• T√©l√©chargement des donn√©es</h3>
                    <div class="card-badge">Export</div>
                </div>
                <div class="card-body">
                    <div id="downloadButtons" class="download-container">
                        <!-- Les boutons de t√©l√©chargement seront inject√©s ici -->
                    </div>
                </div>
            </div>
        </div>

        <!-- INDICATEUR DE CHARGEMENT -->
        <div id="loadingOverlay" class="loading-overlay" style="display: none;">
            <div class="loading-content">
                <div class="spinner"></div>
                <div class="loading-message" id="loadingMessage">G√©n√©ration en cours...</div>
                <div class="loading-status" id="loadingStatus">Pr√©paration des donn√©es...</div>
                <div class="progress-container" style="margin-top: 20px;">
                    <div id="loadingProgressBar" class="progress-bar" style="width: 0%;"></div>
                </div>
            </div>
        </div>

        <!-- PANEL DE D√âBOGAGE (d√©veloppement) -->
        <div id="debugPanel" class="debug-panel" style="display: none;">
            <h4>üîß Debug Info</h4>
            <div class="debug-item">
                <span class="debug-label">Zone:</span>
                <span class="debug-value" id="debugZone">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">B√¢timents:</span>
                <span class="debug-value" id="debugBuildings">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">Carte:</span>
                <span class="debug-value" id="debugMap">-</span>
            </div>
            <div class="debug-item">
                <span class="debug-label">API:</span>
                <span class="debug-value" id="debugAPI">-</span>
            </div>
            <button onclick="window.debugApp && window.debugApp()" class="btn btn-sm" style="margin-top: 10px; font-size: 0.7em;">
                Diagnostic complet
            </button>
        </div>
    </div>

    <!-- SCRIPTS JAVASCRIPT -->
    <!-- Leaflet pour la cartographie -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- Script principal de l'application -->
    <script src="{{ url_for('static', filename='script.js') }}"></script>

    <!-- Scripts utilitaires s√©par√©s -->
    <script>
        /**
         * UTILITAIRES GLOBAUX
         * Fonctions d'aide pour l'interface utilisateur
         */

        // ==================== GESTION DU CHARGEMENT ====================

        /**
         * Affiche l'indicateur de chargement global
         */
        function showLoading(message = 'Chargement en cours...', status = '') {
            const overlay = document.getElementById('loadingOverlay');
            const messageEl = document.getElementById('loadingMessage');
            const statusEl = document.getElementById('loadingStatus');
            const progressBar = document.getElementById('loadingProgressBar');
            
            if (overlay) {
                overlay.style.display = 'flex';
                if (messageEl) messageEl.textContent = message;
                if (statusEl) statusEl.textContent = status;
                if (progressBar) progressBar.style.width = '0%';
            }
            
            // D√©sactiver le bouton de g√©n√©ration
            const generateBtn = document.getElementById('generateBtn');
            if (generateBtn) {
                generateBtn.disabled = true;
                generateBtn.textContent = '‚è≥ G√©n√©ration...';
            }
        }

        /**
         * Cache l'indicateur de chargement
         */
        function hideLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.display = 'none';
            }
            
            // R√©activer le bouton de g√©n√©ration
            const generateBtn = document.getElementById('generateBtn');
            if (generateBtn) {
                generateBtn.disabled = false;
                generateBtn.textContent = 'üèóÔ∏è G√©n√©rer les donn√©es √©nerg√©tiques';
            }
        }

        /**
         * Met √† jour le statut de chargement
         */
        function updateLoadingStatus(status, progress = null) {
            const statusEl = document.getElementById('loadingStatus');
            const progressBar = document.getElementById('loadingProgressBar');
            
            if (statusEl) statusEl.textContent = status;
            if (progressBar && progress !== null) {
                progressBar.style.width = `${Math.min(100, Math.max(0, progress))}%`;
            }
            
            console.log(`üìÑ Statut: ${status}${progress !== null ? ` (${progress}%)` : ''}`);
        }

        // ==================== GESTION DES R√âSULTATS ====================

        /**
         * Affiche la section des r√©sultats
         */
        function showResults(data) {
            const resultsSection = document.getElementById('results');
            if (resultsSection) {
                resultsSection.style.display = 'block';
                resultsSection.classList.add('visible');
                
                // Faire d√©filer vers les r√©sultats
                setTimeout(() => {
                    resultsSection.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                }, 300);
            }
            
            // Afficher les sections de t√©l√©chargement et graphiques si disponibles
            if (data && (data.timeseries || data.data)) {
                const downloadSection = document.getElementById('downloadSection');
                if (downloadSection) downloadSection.style.display = 'block';
            }
            
            if (data && data.charts) {
                const chartsSection = document.getElementById('chartsSection');
                if (chartsSection) chartsSection.style.display = 'block';
            }
        }

        /**
         * Cache la section des r√©sultats
         */
        function hideResults() {
            const resultsSection = document.getElementById('results');
            if (resultsSection) {
                resultsSection.style.display = 'none';
                resultsSection.classList.remove('visible');
            }
            
            ['downloadSection', 'chartsSection'].forEach(id => {
                const section = document.getElementById(id);
                if (section) section.style.display = 'none';
            });
        }

        // ==================== GESTION DES ALERTES ====================

        /**
         * Affiche une alerte utilisateur am√©lior√©e
         */
        function showAlert(message, type = 'info', duration = 5000) {
            const alertsContainer = document.getElementById('alerts');
            if (!alertsContainer) return;
            
            // Cr√©er l'√©l√©ment d'alerte
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            
            // Ic√¥nes selon le type
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            alertDiv.innerHTML = `
                <span class="alert-icon">${icons[type] || icons.info}</span>
                <span class="alert-message">${message}</span>
                <button class="alert-close" onclick="this.parentElement.remove()" aria-label="Fermer l'alerte">√ó</button>
            `;
            
            // Ajouter les styles inline pour le bouton de fermeture
            alertDiv.querySelector('.alert-close').style.cssText = `
                background: none;
                border: none;
                font-size: 1.2em;
                cursor: pointer;
                margin-left: auto;
                padding: 0 5px;
                color: inherit;
                opacity: 0.7;
            `;
            
            // Ajouter l'alerte au conteneur
            alertsContainer.appendChild(alertDiv);
            
            // Animation d'entr√©e
            setTimeout(() => alertDiv.style.transform = 'translateX(0)', 50);
            
            // Supprimer automatiquement apr√®s la dur√©e sp√©cifi√©e
            if (duration > 0) {
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.style.opacity = '0';
                        alertDiv.style.transform = 'translateX(100%)';
                        setTimeout(() => alertDiv.remove(), 300);
                    }
                }, duration);
            }
            
            console.log(`üì¢ [${type.toUpperCase()}] ${message}`);
        }

        // ==================== VALIDATION DES FORMULAIRES ====================

        /**
         * Valide tous les champs du formulaire
         */
        function validateAllInputs() {
            const validations = [
                validateBuildingsNumber(),
                validateDates(),
                validateZoneSelection()
            ];
            
            const isValid = validations.every(v => v.valid);
            
            if (!isValid) {
                const errors = validations
                    .filter(v => !v.valid)
                    .map(v => v.message)
                    .join('\n');
                showAlert(errors, 'error');
            }
            
            return isValid;
        }

        /**
         * Valide le nombre de b√¢timents
         */
        function validateBuildingsNumber() {
            const numBuildings = document.getElementById('numBuildings')?.value;
            const num = parseInt(numBuildings);
            
            if (!numBuildings || isNaN(num) || num < 1 || num > 10000) {
                return {
                    valid: false,
                    message: 'Le nombre de b√¢timents doit √™tre entre 1 et 10000'
                };
            }
            
            return { valid: true };
        }

        /**
         * Valide les dates
         */
        function validateDates() {
            const startDate = document.getElementById('startDate')?.value;
            const endDate = document.getElementById('endDate')?.value;
            
            if (!startDate || !endDate) {
                return {
                    valid: false,
                    message: 'Veuillez s√©lectionner des dates de d√©but et de fin'
                };
            }
            
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            if (start >= end) {
                return {
                    valid: false,
                    message: 'La date de fin doit √™tre apr√®s la date de d√©but'
                };
            }
            
            // V√©rifier que la p√©riode n'est pas trop longue
            const daysDiff = (end - start) / (1000 * 60 * 60 * 24);
            if (daysDiff > 365) {
                return {
                    valid: false,
                    message: 'La p√©riode ne peut pas d√©passer 365 jours'
                };
            }
            
            return { valid: true };
        }

        /**
         * Valide la s√©lection de zone
         */
        function validateZoneSelection() {
            const zoneSelect = document.getElementById('zoneSelect')?.value;
            const customLocation = document.getElementById('customLocation')?.value;
            
            if (!zoneSelect && !customLocation) {
                return {
                    valid: false,
                    message: 'Veuillez s√©lectionner une zone ou entrer des coordonn√©es'
                };
            }
            
            // Valider le format des coordonn√©es personnalis√©es si pr√©sentes
            if (customLocation) {
                const coordPattern = /^-?\d+\.?\d*\s*,\s*-?\d+\.?\d*$/;
                if (!coordPattern.test(customLocation.trim())) {
                    return {
                        valid: false,
                        message: 'Format de coordonn√©es invalide (ex: 3.1390, 101.6869)'
                    };
                }
            }
            
            return { valid: true };
        }

        // ==================== UTILITAIRES D'INTERFACE ====================

        /**
         * Active/d√©sactive le mode debug
         */
        function toggleDebugMode() {
            const debugPanel = document.getElementById('debugPanel');
            if (debugPanel) {
                const isVisible = debugPanel.style.display !== 'none';
                debugPanel.style.display = isVisible ? 'none' : 'block';
                
                if (!isVisible && window.debugApp) {
                    // Mettre √† jour les informations de debug
                    const debugInfo = window.debugApp();
                    document.getElementById('debugZone').textContent = debugInfo.currentZone?.name || 'Aucune';
                    document.getElementById('debugBuildings').textContent = debugInfo.buildingsCount || '0';
                    document.getElementById('debugMap').textContent = debugInfo.mapInitialized ? 'OK' : 'NOK';
                    document.getElementById('debugAPI').textContent = 'Test...';
                    
                    // Test de connexion API
                    if (window.testConnection) {
                        window.testConnection().then(ok => {
                            document.getElementById('debugAPI').textContent = ok ? 'OK' : 'NOK';
                        });
                    }
                }
            }
        }

        /**
         * R√©initialise le formulaire
         */
        function resetForm() {
            // R√©initialiser les champs
            document.getElementById('zoneSelect').value = '';
            document.getElementById('customLocation').value = '';
            document.getElementById('numBuildings').value = '100';
            document.getElementById('startDate').value = '2024-01-01';
            document.getElementById('endDate').value = '2024-01-31';
            document.getElementById('freq').value = 'D';
            
            // R√©initialiser l'affichage des zones
            const zoneDisplays = ['zoneNameDisplay', 'zoneTypeDisplay', 'zonePopulationDisplay', 'zoneStateDisplay'];
            zoneDisplays.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.textContent = '-';
            });
            
            // Cacher les r√©sultats
            hideResults();
            
            // Nettoyer la carte si disponible
            if (window.clearMapPreview) {
                window.clearMapPreview();
            }
            
            showAlert('Formulaire r√©initialis√©', 'info', 2000);
        }

        /**
         * Affiche un aper√ßu des param√®tres de g√©n√©ration
         */
        function previewParameters() {
            if (!validateAllInputs()) return;
            
            const params = {
                zone: document.getElementById('zoneSelect').value || 'Coordonn√©es personnalis√©es',
                buildings: document.getElementById('numBuildings').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                frequency: document.getElementById('freq').value,
                noise: document.getElementById('noiseLevel')?.value || 'medium',
                seasonality: document.getElementById('seasonality')?.value || 'true',
                quality: document.getElementById('dataQuality')?.value || 'high'
            };
            
            const freqLabels = { H: 'Horaire', D: 'Quotidienne', W: 'Hebdomadaire', M: 'Mensuelle' };
            const startDate = new Date(params.startDate);
            const endDate = new Date(params.endDate);
            const daysDiff = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24));
            
            const message = `
üìä Aper√ßu des param√®tres de g√©n√©ration :
‚Ä¢ Zone : ${params.zone}
‚Ä¢ B√¢timents : ${params.buildings}
‚Ä¢ P√©riode : ${daysDiff} jours (${params.startDate} ‚Üí ${params.endDate})
‚Ä¢ Fr√©quence : ${freqLabels[params.frequency] || params.frequency}
‚Ä¢ Qualit√© : ${params.quality}
‚Ä¢ Saisonnalit√© : ${params.seasonality === 'true' ? 'Activ√©e' : 'D√©sactiv√©e'}
            `.trim();
            
            alert(message);
        }

        // ==================== INITIALISATION DES √âCOUTEURS ====================

        document.addEventListener('DOMContentLoaded', function() {
            // √âcouteurs pour les boutons d'action
            const resetBtn = document.getElementById('resetBtn');
            if (resetBtn) resetBtn.addEventListener('click', resetForm);
            
            const previewBtn = document.getElementById('previewBtn');
            if (previewBtn) previewBtn.addEventListener('click', previewParameters);
            
            // Validation en temps r√©el
            const inputs = ['numBuildings', 'startDate', 'endDate', 'customLocation'];
            inputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('blur', function() {
                        // Validation silencieuse au blur
                        validateAllInputs();
                    });
                }
            });
            
            // Raccourcis clavier
            document.addEventListener('keydown', function(e) {
                // Ctrl+D pour toggle debug
                if (e.ctrlKey && e.key === 'd') {
                    e.preventDefault();
                    toggleDebugMode();
                }
                
                // Ctrl+R pour reset (emp√™cher le reload par d√©faut)
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    resetForm();
                }
            });
            
            console.log('üéØ Utilitaires d\'interface initialis√©s');
        });

        // Exposer les fonctions utilitaires globalement
        window.showLoading = showLoading;
        window.hideLoading = hideLoading;
        window.updateLoadingStatus = updateLoadingStatus;
        window.showResults = showResults;
        window.hideResults = hideResults;
        window.showAlert = showAlert;
        window.validateAllInputs = validateAllInputs;
        window.toggleDebugMode = toggleDebugMode;
        window.resetForm = resetForm;
        window.previewParameters = previewParameters;
    </script>

    <!-- Script de finalisation -->
    <script>
        // Message de bienvenue et v√©rifications finales
        console.log(`
üá≤üáæ G√âN√âRATEUR MALAYSIA - INTERFACE COMPL√àTE
=============================================
‚úÖ HTML structur√© et accessible
‚úÖ CSS moderne et responsive  
‚úÖ JavaScript fonctionnel charg√©
‚úÖ Syst√®me de cartographie int√©gr√©
‚úÖ Gestion d'erreurs robuste
‚úÖ Interface utilisateur am√©lior√©e

FONCTIONNALIT√âS:
üó∫Ô∏è Carte interactive avec Leaflet
üìä Affichage des donn√©es corrig√©
üîß Syst√®me de debugging int√©gr√©
üì± Design responsive et accessible
‚ö° Validation en temps r√©el
üé® Animations et transitions fluides

RACCOURCIS CLAVIER:
‚Ä¢ Ctrl+D : Activer/d√©sactiver le debug
‚Ä¢ Ctrl+R : R√©initialiser le formulaire

POUR D√âBOGUER:
‚Ä¢ Ouvrir la console d√©veloppeur (F12)
‚Ä¢ Utiliser debugApp() pour diagnostic complet
‚Ä¢ Activer le panel debug avec Ctrl+D

Pr√™t pour la g√©n√©ration de donn√©es Malaysia! üöÄ
        `);

        // Validation finale de l'interface
        setTimeout(() => {
            const criticalElements = [
                'generateBtn', 'previewMap', 'numBuildings', 
                'startDate', 'endDate', 'results', 'dataPreview'
            ];
            
            const missing = criticalElements.filter(id => !document.getElementById(id));
            
            if (missing.length > 0) {
                console.error('‚ùå √âl√©ments critiques manquants:', missing);
                showAlert(`Interface incompl√®te. √âl√©ments manquants: ${missing.join(', ')}`, 'error');
            } else {
                console.log('‚úÖ Interface valid√©e - Tous les √©l√©ments critiques pr√©sents');
                
                // Activer le debug en mode d√©veloppement
                if (window.location.hostname === 'localhost' || 
                    window.location.search.includes('debug=true')) {
                    setTimeout(() => toggleDebugMode(), 2000);
                }
            }
        }, 1000);
    </script>
</body>
</html>